

# 04. 非機能要件（Non-functional Requirements）

本章では、Drawing Evaluation App の品質基準を定義する。  
本アプリは AI を活用したリアルタイム画像評価を行うため、性能・セキュリティ・運用性に関する非機能要件が重要となる。

非機能要件は、実装フェーズにおける基準であり、  
Chapter 02（Architecture）  
Chapter 06（API Spec）  
Chapter 07（Evaluation Logic）  
Chapter 08（Database）  
と整合するように策定される。

---

## 4.1 パフォーマンス要件（Performance）

### 4.1.1 画像評価時間
- **5秒以内**（1画像あたり）
  - 内訳（目安）
    - 前処理（白黒化・正規化）：〜0.3 秒  
    - 特徴抽出（PyTorch推論）：〜1.5 秒  
    - ヒートマップ生成：〜0.5 秒  
    - DeepSeek API レスポンス：〜1.5〜2.5 秒  
- 全処理の合計が **最大5秒**に収まることを目標とする。

### 4.1.2 APIレスポンス
- 認証・お題一覧・履歴などの軽量APIは **200 ms 以下**。

### 4.1.3 モバイルアプリ応答性
- 画面遷移は 300ms 以内を目標とする。  
- ローディング表示は最低限に抑える。

---

## 4.2 可用性（Availability）

### 4.2.1 稼働率
- **99% 以上の稼働率**を目標とする（β版段階では 97% 以上）。

### 4.2.2 障害対応方針
- API 障害時はアプリ側で「再試行ボタン」を表示。
- DeepSeek API 障害時は fallback メッセージ：
  - 「現在講評生成が混雑しています。スコアのみ表示中。」

### 4.2.3 依存サービス
本アプリは以下の外部サービスの可用性に依存する。

- Supabase（認証・DB・ストレージ）  
- DeepSeek API  
- Google OAuth  
- モバイルプラットフォーム（iOS/Android）  

---

## 4.3 セキュリティ要件（Security）

### 4.3.1 通信
- 全通信は **HTTPS** 必須。  
- HTTP は無効化。

### 4.3.2 認証
- Google OAuth によるログイン  
- バックエンドでは **JWT** によりユーザーを識別  
- トークンの有効期限切れのハンドリングを明示する

### 4.3.3 権限制御
- **自分の submissions のみ閲覧可能**  
- 管理者のみ challenges を追加・編集可能  
- ストレージは「署名付きURL」を推奨

### 4.3.4 不正画像対策
- NSFWチェック（将来実装）
- サイズ制限：最大10MB  
- 拡張子チェック（JPEG/PNG のみ）

---

## 4.4 拡張性・スケーラビリティ（Scalability）

### 4.4.1 モデル差し替え
- PyTorch モデル（ResNet / ViT）はコンテナ内で差し替え可能な構成とする。

### 4.4.2 評価ワーカー分離
- 将来的に「評価ワーカー」を別サービスに分けて、  
  - FastAPI＝API専用  
  - Worker＝PyTorch推論専用  
  とできる構造にする。

### 4.4.3 将来機能追加に耐えられる設計
- DB は JSONB 活用により項目追加が容易  
- DeepSeek 講評の構造が変わっても対応可能  
- UI は画面数を増やしやすい構造とする

---

## 4.5 保守性（Maintainability）

### 4.5.1 コード構造
- FastAPI と React Native はディレクトリ構造を明確に分離  
- Backend は以下のモジュール構造：
  - `auth/`
  - `challenges/`
  - `submissions/`
  - `evaluation/`
  - `services/deepseek.py` など

### 4.5.2 Docker 化
- バックエンド（FastAPI）は Docker コンテナ化  
- ローカル・ステージング・本番で環境差異をなくす

### 4.5.3 バージョン管理
- 主要ライブラリは SemVer（1.2.3）で管理  
- model バージョンは `model_version` として API/DB で保持

---

## 4.6 ログ・監視（Monitoring）

### 4.6.1 アプリケーションログ
- FastAPI は以下を記録
  - リクエストパス  
  - ステータスコード  
  - エラー内容  
  - 評価処理時間  

### 4.6.2 評価処理ログ
- submissions の `status` は  
  - `processing` → `completed` → `failed`  
  のいずれかで管理。

### 4.6.3 モニタリング
- 可能であれば以下を導入（β版では任意）
  - Prometheus + Grafana  
  - Supabase Studio（クエリモニタリング）

---

## 4.7 データ保護（Data Protection）

### 4.7.1 個人情報
- ユーザー識別には Google OAuth の ID を使用  
- アプリ側はメールアドレスを保持しない（推奨）

### 4.7.2 データ保持期間
- ユーザー投稿データの保持は原則無期限  
- 退会時にユーザーデータ削除（今後検討）

### 4.7.3 バックアップ
- Supabase または PostgreSQL の標準バックアップを使用  
- ストレージはバケット単位でバージョニング可能な構成が望ましい

---

## 4.8 モバイルアプリ要件

### 4.8.1 デバイス対応
- iOS：iOS 16+  
- Android：Android 10+  
  （MVP の想定）

### 4.8.2 インターネット必須
- オフライン評価は非対応  
- モバイルデータ通信でも動作すること

---

**End of Document**

